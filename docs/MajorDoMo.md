## Интеграция LVT в [сервер MajorDoMo](https://mjdm.ru/)

### Установка интеграции в MajorDoMo

 1. Скопировать все файлы из /scripts/majordomo в корневой каталог сайта MajorDoMo:

 * **/lvt.php**: Основной интеграционный скрипт LVT
 * **/lib/lvt.class.php**: библиотека низкоуровневых функций для взаимодействия с LVT
 * **/modules/terminals/tts/lvt.addon.php**: Поддержка LVT TTS для терминала

 2. В файле ./config.php определить следующие константы:
 ```php
define('LVT_SERVER','localhost'); // Адрес LVT сервера. Значение по умолчанию - localhost
define('LVT_PORT', 7999);         // Порт LVT API сервиса. По умолчанию 7999
define('LVT_RESTRICT',true);      // Разрешить доступ к скрипту только с адреса LVT сервера и с использованием метода POST
```
3. В файле конфигурации LVT сервера просмотреть и настроить параметры в разделе **[MajorDoMo]**

4. Перезапустить сервер LVT

### Настройка терминалов MajorDoMo для совместной работы с LVT

  * **Системное имя** должно совпадать с соответствующим ID терминала в настройках сервера LVT
  * **Хост (адрес)** не влияет на работу LVT но имеет значение, если терминал будет 
    использоваться в качестве медиа плеера
  * **Тип TTS** должен быть установлен в "lvt".

  Если в настройках LVT разрешено использование скрипта интеграции, то LVT будет 
автоматически создавать и синхронизировать настройки терминалов в MajorDoMo. 
При этом обновляется название терминала, его адрес, тип TTS и отслеживается и его статус online/offline.


### Описание низкоуровнего API LVT

После установки и настройки интеграции LVT в MajorDoMo пользователю становятся доступны следующие функции:

```php
// Запрос текущего состояния LVT
// Возвращает JSON c состоянием сервера и терминалов либо сообщение об ошибке...
function lvtGetStatus()

// Проговорить сообщение на LVT терминале
// Возвращает код результата, "Ok" если сообщение было доставлено успешно.
function lvtSayTo( $terminalId, $message )

// Проговорить сообщение на LVT терминале и перейти в режим ожидания команды.
// Если терминал распознает голос, то распознанный текст будет передан в MajorDoMo
// как голосовая команда с соответствующего терминала, в начале которой будет 
// вставлена строка $answerPrefix.
// Если терминал выйдет из режима ожидания команды по таймауту, а $answerPrefix 
// не пуст - в качестве команды будет передан $answerPrefix.
//
// НЕ РЕАЛИЗОВАНО:
// В массиве $dictionary содержится список ключевых слов, которые будут добавлены 
// в словарь распознаваемых слов.
// Если $dictionary пуст, то включается режим распознавания без ограничения словаря
//
function lvtAsk( $terminalId, $message, $answerPrefix, $dictionary=array() )

// Проговорить сообщение на LVT терминале и перейти в режим диалога "да-нет-отстань".
// После завершения диалога в MajorDoMo будет передана одна из двух команд:
// $answerPrefix да
// $answerPrefix нет
// Если параметр $answerPrefix не пуст то при завершении диалога отказом от ответа
// MD получит команду, содержащую только $answerPrefix 
function lvtYesNo( $terminalId, $message, $answerPrefix )

```